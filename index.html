<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAMMS::Avalanche Viewer</title>
    <link rel="icon" type="image/webp" href="/RAMMS_Logo_Avalanche.webp" />
  </head>
  <body>
    <calcite-shell content-behind>
      <!-- Header -->
      <calcite-navigation slot="header">
        <calcite-navigation-logo
          slot="logo"
          heading="RAMMS::Avalanche Simulation Viewer"
          thumbnail="/RAMMS_Logo_Avalanche.webp"
          description="Data created with RAMMS::Avalanche and visualized with ArcGIS Maps SDK for JavaScript."
          href="https://ramms.ch/ramms-avalanche/"
          target="_blank"
          rel="noopener noreferrer"
        >
        </calcite-navigation-logo>
      </calcite-navigation>

      <!-- Left Panel - Avalanche Selection -->
      <calcite-shell-panel
        slot="panel-start"
        position="start"
        display-mode="float"
        width-scale="s"
      >
        <calcite-panel heading="Avalanches">
          <calcite-list id="avalanche-list" selection-mode="single">
            <!-- Populated dynamically -->
          </calcite-list>
        </calcite-panel>
      </calcite-shell-panel>

      <!-- Right Panel - Info & Status -->
      <calcite-shell-panel
        slot="panel-end"
        position="end"
        display-mode="float"
        width-scale="m"
      >
        <calcite-panel heading="Simulation Info" collapsible collapse-direction="top">
          <calcite-block heading="Current Avalanche" expanded>
            <calcite-icon slot="icon" icon="initiative"></calcite-icon>
            <p id="avalanche-name">-</p>
            <p
              id="avalanche-description"
              style="font-size: 0.85rem; color: var(--calcite-color-text-3)"
            >
              Select an avalanche to begin
            </p>
          </calcite-block>

          <calcite-block heading="Release Zone" expanded collapsible>
            <calcite-icon slot="icon" icon="polygon"></calcite-icon>
            <div class="info-grid">
              <span class="info-label">Release Depth:</span>
              <span id="release-depth">-</span>
              <span class="info-label">Release Area:</span>
              <span id="release-area">-</span>
            </div>
          </calcite-block>

          <calcite-block heading="DEM Info" expanded collapsible>
            <calcite-icon slot="icon" icon="layer-basemap"></calcite-icon>
            <div class="info-grid">
              <span class="info-label">Source:</span>
              <span id="dem-source">-</span>
              <span class="info-label">Resolution:</span>
              <span id="dem-resolution">-</span>
            </div>
          </calcite-block>

          <calcite-block heading="Status" expanded collapsible>
            <calcite-icon slot="icon" icon="information"></calcite-icon>
            <div id="status" class="status-display loading">
              Initializing...
            </div>
            <div id="loading-progress" style="margin-top: 8px;">
              <calcite-progress
                id="progress-bar"
                type="determinate"
                value="0"
              ></calcite-progress>
              <p
                id="progress-text"
                style="text-align: center; font-size: 0.75rem; margin-top: 4px"
              >
                Loading frames...
              </p>
            </div>
          </calcite-block>
        </calcite-panel>
      </calcite-shell-panel>

      <!-- Main Content: Scene View -->
      <arcgis-scene
        basemap="satellite"
        ground="world-elevation"
      ></arcgis-scene>
    </calcite-shell>

    <!-- Animation Controls - Outside shell, positioned absolutely -->
    <div id="animation-panel">
      <div class="control-panel">
        <!-- Time Display -->
        <div class="time-display">
          Time: <span id="current-time" class="time-value">0.00</span>s
        </div>

        <!-- Time Slider -->
        <div class="slider-container">
          <calcite-slider
            id="time-slider"
            min="0"
            max="66"
            step="2"
            value="0"
            label-handles
            snap
          ></calcite-slider>
        </div>

        <!-- Playback Controls -->
        <div class="control-row">
          <calcite-button
            id="play-btn"
            icon-start="play-f"
            appearance="solid"
            kind="brand"
            scale="s"
          >
            Play
          </calcite-button>
          <calcite-button
            id="reset-btn"
            icon-start="reset"
            appearance="outline"
            kind="neutral"
            scale="s"
          >
            Reset
          </calcite-button>
        </div>

        <!-- Settings Row -->
        <div class="control-row">
          <calcite-label layout="inline" scale="s">
            Speed
            <calcite-select id="speed-select" scale="s">
              <calcite-option value="2000">0.5x</calcite-option>
              <calcite-option value="1000">1x</calcite-option>
              <calcite-option value="500">2x</calcite-option>
              <calcite-option value="250" selected>4x</calcite-option>
            </calcite-select>
          </calcite-label>

          <calcite-label layout="inline" scale="s">
            Grid
            <calcite-select id="smoothing-select" scale="s">
              <calcite-option value="1">1x</calcite-option>
              <calcite-option value="2">2x</calcite-option>
              <calcite-option value="3">3x</calcite-option>
              <calcite-option value="4" selected>4x</calcite-option>
            </calcite-select>
          </calcite-label>

          <calcite-label layout="inline" scale="s">
            Flatten
            <calcite-select id="flatten-select" scale="s">
              <calcite-option value="0">Off</calcite-option>
              <calcite-option value="2">Low</calcite-option>
              <calcite-option value="5">Medium</calcite-option>
              <calcite-option value="10">High</calcite-option>
              <calcite-option value="20" selected>Very High</calcite-option>
            </calcite-select>
          </calcite-label>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <calcite-loader active scale="l"></calcite-loader>
      <p class="loading-text">Loading Avalanche Simulation...</p>
    </div>

    <!-- Layer List Panel - Bottom Left -->
    <div id="layer-panel">
      <calcite-panel heading="Layers" collapsible collapsed collapse-direction="bottom">
        <calcite-list id="layer-list">
          <calcite-list-item label="Snow Cover">
            <calcite-icon slot="content-start" icon="layer"></calcite-icon>
            <calcite-slider
              slot="content-end"
              id="snow-cover-opacity"
              min="0"
              max="100"
              value="100"
              step="5"
              scale="s"
              style="width: 100px;"
            ></calcite-slider>
          </calcite-list-item>
          <calcite-list-item label="Slopes">
            <calcite-icon slot="content-start" icon="layer"></calcite-icon>
            <calcite-slider
              slot="content-end"
              id="slopes-opacity"
              min="0"
              max="100"
              value="100"
              step="5"
              scale="s"
              style="width: 100px;"
            ></calcite-slider>
          </calcite-list-item>
          <calcite-list-item label="Release Zone">
            <calcite-icon slot="content-start" icon="polygon"></calcite-icon>
            <calcite-slider
              slot="content-end"
              id="release-zone-opacity"
              min="0"
              max="100"
              value="100"
              step="5"
              scale="s"
              style="width: 100px;"
            ></calcite-slider>
          </calcite-list-item>
        </calcite-list>
      </calcite-panel>
    </div>

    <!-- Quote Banner -->
    <div id="quote-banner">
      <div class="quote-text">"All models are wrong, but some are useful."</div>
      <div class="quote-author">â€” George E. P. Box</div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
